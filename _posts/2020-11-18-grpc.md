---
title: "Distributed System homework: Pub/Sub Messaging with grpc"
categories:
  - System
---

# protobuf
protobuf是一种于序列化数据的方法——它能够在不同平台之间、在不同语言编写的程序之间进行数据的通信。
程序也可以很方便地对protobuf数据进行读取、修改和扩展。可以看成是一种效率更高、面向通信和存储的XML数据格式。

protobuf的定义方式比较类似C语言中的结构体，使用关键字段repeated来实现类似C++中的变长数组。protobuf提供了接口编译器protoc，对于一个定义好了的.proto文件和目标语言，protoc将会生成对应语言的类和方法，提供编程者读写数据的接口。

# grpc based on protobuf
grpc基于protobuf实现。grpc使用protobuf来表达远程过程调用中的参数和返回值。调用protoc编译器的时候，加入参数就可以增加grpc的支持：
```
python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. helloworld.proto
```
生成protobuf对应的定义文件filename_pb2.py以及对应grpc两端的定义文件filename_pb2_grpc.py。用户将要实现一个用于执行服务的类，它继承文件中定义的父类，并且给出rpc函数的具体实现。在客户端上，使用grpc前需要生成一个stub，并通过这个stub对远程的rpc函数进行调用。

# What is Pub/Sub Messaging?
Google云服务网站提供了对Pub/Sub服务模式简洁有效的介绍[[1]][Google Cloud]。简单来说，Pub/Sub模式由下面这些组件构成：

* 主题(topic)：作为发布者发送消息的目标资源
* 订阅：从一个特定的主题传送发布应用的消息。
* 消息：发布者向主题发送并且最终传送给订阅者的数据。
* 消息特性：消息的特性（笑）。

其中发布者和订阅者的关系可以是多对多的。Pub/Sub模式的工作流程如图所示，订阅者可以从主题拉取消息，也可以等待主题向自己推送消息。订阅者需要对已经接收了的消息返回一个确认。

![Pub/Sub](../photos/pub_sub_flow.svg)

[Google Cloud]: https://cloud.google.com/pubsub/docs/overview